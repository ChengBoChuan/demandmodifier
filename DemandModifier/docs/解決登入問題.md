# 🔑 解決 ModPublisher 登入問題

## 問題說明

當你嘗試發行模組時，收到錯誤訊息：
```
Could not auto log in: You were not logged in before. Launch the game and log in or pass email and password as args
New version publishing process failed
```

這是因為 ModPublisher 需要你的 Paradox 帳號登入資訊才能上傳模組。

---

## ✅ 解決方法 1：在遊戲中登入（最簡單）

### 步驟：

1. **啟動 Cities: Skylines 2**
   
2. **登入 Paradox 帳號**
   - 點擊主選單右上角的「登入」按鈕
   - 輸入你的 Paradox 帳號和密碼
   - 確認登入成功（會顯示你的使用者名稱）

3. **關閉遊戲**
   - 正常退出遊戲（重要！）
   - 確保遊戲完全關閉

4. **重新執行發行命令**
   ```powershell
   cd e:\Code\CSL2\DemandModifier\DemandModifier\DemandModifier
   dotnet publish /p:PublishProfile=PublishNewVersion
   ```

5. **完成！**
   - ModPublisher 現在會自動使用你儲存的登入資訊

### 原理說明

當你在遊戲中登入 Paradox 帳號後，遊戲會儲存一個登入 token 在：
```
%AppData%\..\LocalLow\Colossal Order\Cities Skylines II\
```

ModPublisher 會讀取這個 token 來認證你的身份，所以你不需要每次都輸入帳號密碼。

---

## ✅ 解決方法 2：使用命令列參數（進階）

如果你不想每次都開遊戲登入，可以直接在命令列提供帳號密碼。

### ⚠️ 警告：不建議在腳本中儲存明文密碼

### 直接執行（不推薦）

```powershell
& "E:\SteamLibrary\steamapps\common\Cities Skylines II\Cities2_Data\Content\Game\.ModdingToolchain\ModPublisher\ModPublisher.exe" `
  NewVersion `
  "E:\Code\CSL2\DemandModifier\DemandModifier\DemandModifier\Properties\PublishConfiguration.xml" `
  -c "C:\Users\zheng\AppData\LocalLow\Colossal Order\Cities Skylines II\Mods\DemandModifier" `
  -e "your-email@example.com" `
  -p "your-password" `
  -v
```

將 `your-email@example.com` 和 `your-password` 替換為你的 Paradox 帳號和密碼。

### 使用環境變數（較安全）

```powershell
# 設定環境變數（僅此次終端機有效）
$env:PDX_EMAIL = "your-email@example.com"
$env:PDX_PASSWORD = "your-password"

# 執行發行
& "E:\SteamLibrary\steamapps\common\Cities Skylines II\Cities2_Data\Content\Game\.ModdingToolchain\ModPublisher\ModPublisher.exe" `
  NewVersion `
  "E:\Code\CSL2\DemandModifier\DemandModifier\DemandModifier\Properties\PublishConfiguration.xml" `
  -c "C:\Users\zheng\AppData\LocalLow\Colossal Order\Cities Skylines II\Mods\DemandModifier" `
  -e $env:PDX_EMAIL `
  -p $env:PDX_PASSWORD `
  -v
```

---

## 📝 完整發行流程（更新版）

### 前置準備（僅需做一次）

1. **啟動 Cities: Skylines 2**
2. **在主選單登入 Paradox 帳號**
3. **關閉遊戲**

### 每次發行時

```powershell
# 1. 切換到專案目錄
cd e:\Code\CSL2\DemandModifier\DemandModifier\DemandModifier

# 2. 更新版本號和變更日誌
# 編輯 Properties\PublishConfiguration.xml

# 3. 清理並建置
dotnet clean
dotnet build -c Release

# 4. 發行到 Paradox Mods
dotnet publish /p:PublishProfile=PublishNewVersion

# 5. 成功！
```

---

## 🚀 使用快速發行腳本（推薦）

我已經為你建立了快速發行腳本，使用起來更簡單：

```powershell
# 確保已在遊戲中登入過一次
cd e:\Code\CSL2\DemandModifier\DemandModifier\DemandModifier

# 執行快速發行
.\quick-publish.ps1
```

腳本會自動處理所有步驟，包括：
- ✅ 檢查必要檔案
- ✅ 更新版本號
- ✅ 建置專案
- ✅ 驗證建置產物
- ✅ 發行到 Paradox Mods

---

## ❓ 常見問題

### Q1: 我已經在遊戲中登入了，但還是顯示未登入？

**A:** 確保：
1. 遊戲完全關閉（檢查工作管理員中沒有 Cities2.exe）
2. 登入時選擇了「記住我」
3. 沒有使用遊戲的「離線模式」

### Q2: 我不記得 Paradox 帳號密碼怎麼辦？

**A:** 
1. 前往 https://accounts.paradoxplaza.com/
2. 點擊「忘記密碼」
3. 按照步驟重設密碼
4. 在遊戲中使用新密碼登入

### Q3: 可以不用每次都登入嗎？

**A:** 可以！只要：
1. 在遊戲中登入一次並選擇「記住我」
2. 之後發行時 ModPublisher 會自動使用儲存的 token
3. Token 通常有效期很長（數週或數月）

### Q4: 我想在 CI/CD 中自動發行怎麼辦？

**A:** 這需要使用方法 2（命令列參數），建議：
1. 使用 GitHub Secrets 儲存帳號密碼
2. 在 CI workflow 中設定環境變數
3. 或使用 Paradox API token（如果可用）

---

## 🔐 安全提醒

**請注意：**
- ❌ 不要在 Git 儲存庫中儲存明文密碼
- ❌ 不要在公開的腳本中寫入密碼
- ✅ 使用環境變數或遊戲內登入
- ✅ 使用 .gitignore 排除包含密碼的檔案

如果你的密碼意外被提交到 Git：
1. 立即更改密碼
2. 使用 `git filter-branch` 或 BFG Repo-Cleaner 清理歷史記錄
3. Force push 到遠端儲存庫

---

**最後更新**：2025-10-27
